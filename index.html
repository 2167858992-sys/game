<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>åè¯­R&BçŒœæ­Œç‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #4a1942 50%, #1a1a2e 100%);
      min-height: 100vh;
      color: white;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 15px;
      min-height: 100vh;
    }
    
    .hidden { display: none !important; }
    
    /* é€šç”¨æŒ‰é’®æ ·å¼ */
    .btn {
      display: block;
      width: 100%;
      padding: 15px 20px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    
    .btn:active {
      transform: scale(0.98);
      opacity: 0.9;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #eab308 0%, #f97316 100%);
    }
    
    .btn-gray {
      background: #374151;
    }
    
    .btn-small {
      padding: 10px 15px;
      font-size: 14px;
    }
    
    /* ä¸»èœå• */
    #menu {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      padding: 20px;
    }
    
    .logo {
      font-size: 60px;
      margin-bottom: 15px;
    }
    
    .title {
      font-size: 28px;
      font-weight: bold;
      background: linear-gradient(90deg, #fbbf24, #ec4899, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: #9ca3af;
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    .artists {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .artist {
      text-align: center;
    }
    
    .artist-emoji {
      font-size: 28px;
    }
    
    .artist-name {
      font-size: 11px;
      color: #9ca3af;
    }
    
    .menu-buttons {
      width: 100%;
      max-width: 300px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .dev-credit {
      margin-top: 30px;
      font-size: 12px;
      color: #4b5563;
      border-top: 1px solid #374151;
      padding-top: 15px;
    }
    
    /* éš¾åº¦é€‰æ‹© */
    .difficulty-card {
      background: linear-gradient(135deg, var(--color-from), var(--color-to));
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .difficulty-card:active {
      transform: scale(0.98);
    }
    
    .difficulty-icon {
      font-size: 45px;
    }
    
    .difficulty-info h3 {
      font-size: 20px;
      margin-bottom: 5px;
    }
    
    .difficulty-info p {
      font-size: 13px;
      opacity: 0.85;
    }
    
    /* æ¨¡å¼é€‰æ‹© */
    .mode-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .mode-card {
      background: rgba(55, 65, 81, 0.7);
      border-radius: 16px;
      padding: 20px 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .mode-card:active {
      background: rgba(75, 85, 101, 0.8);
      transform: scale(0.98);
    }
    
    .mode-icon {
      font-size: 36px;
      margin-bottom: 8px;
    }
    
    .mode-name {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 4px;
    }
    
    .mode-desc {
      font-size: 12px;
      color: #9ca3af;
    }
    
    /* æ¸¸æˆç•Œé¢ */
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .game-stats {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .stat-badge {
      background: #1f2937;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 13px;
    }
    
    .stat-badge.score { background: #ca8a04; }
    .stat-badge.streak { background: #ea580c; animation: pulse 1s infinite; }
    .stat-badge.player1 { background: #db2777; }
    .stat-badge.player2 { background: #2563eb; }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .timer {
      font-size: 24px;
      font-weight: bold;
    }
    
    .timer.warning {
      color: #ef4444;
      animation: pulse 0.5s infinite;
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: #374151;
      border-radius: 3px;
      margin-bottom: 15px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ec4899, #8b5cf6);
      border-radius: 3px;
      transition: width 0.3s;
    }
    
    .mode-badge {
      display: inline-block;
      background: rgba(139, 92, 246, 0.5);
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 13px;
      margin-bottom: 15px;
    }
    
    .question-box {
      background: rgba(31, 41, 55, 0.5);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .question-label {
      color: #9ca3af;
      margin-bottom: 10px;
      font-size: 15px;
    }
    
    .question-content {
      font-size: 20px;
      line-height: 1.6;
    }
    
    .question-emoji {
      font-size: 50px;
      letter-spacing: 10px;
    }
    
    .fill-input-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .fill-input {
      flex: 1;
      padding: 12px 15px;
      background: #374151;
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      text-align: center;
    }
    
    .fill-input:focus {
      outline: 2px solid #fbbf24;
    }
    
    .hint-btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 10px;
      font-size: 13px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    
    .hint-btn:disabled {
      background: #374151;
      color: #6b7280;
    }
    
    .hint-text {
      color: #9ca3af;
      font-size: 14px;
      margin-top: 8px;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .options-grid.six-options {
      grid-template-columns: 1fr 1fr;
    }
    
    .option-btn {
      background: #1f2937;
      border: none;
      border-radius: 12px;
      padding: 12px;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
    }
    
    .option-btn:active {
      background: #374151;
      transform: scale(0.98);
    }
    
    .option-btn.correct {
      background: #16a34a;
      box-shadow: 0 0 0 2px #4ade80;
    }
    
    .option-btn.wrong {
      background: #dc2626;
      box-shadow: 0 0 0 2px #f87171;
    }
    
    .option-btn.dimmed {
      opacity: 0.5;
    }
    
    .option-title {
      font-weight: bold;
      font-size: 15px;
      margin-bottom: 4px;
    }
    
    .option-artist {
      font-size: 12px;
      color: #9ca3af;
    }
    
    .answer-result {
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .answer-result.correct { background: rgba(22, 163, 74, 0.3); }
    .answer-result.wrong { background: rgba(220, 38, 38, 0.3); }
    
    .answer-text {
      font-size: 14px;
      color: #9ca3af;
      margin-top: 8px;
    }
    
    .answer-song {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 5px;
      margin-left: 5px;
    }
    
    /* å¤šäººæ¯”åˆ† */
    .multi-scores {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 12px;
    }
    
    .multi-score {
      padding: 8px;
      border-radius: 10px;
      text-align: center;
      font-size: 14px;
    }
    
    .multi-score.p1 { background: rgba(219, 39, 119, 0.3); }
    .multi-score.p2 { background: rgba(37, 99, 235, 0.3); }
    .multi-score.active { box-shadow: 0 0 0 2px white; }
    
    /* ç©å®¶åˆ‡æ¢ */
    .player-switch {
      text-align: center;
      padding: 40px 20px;
    }
    
    .player-switch-icon {
      font-size: 60px;
      margin-bottom: 15px;
    }
    
    .player-switch h2 {
      font-size: 24px;
      margin-bottom: 20px;
    }
    
    .switch-scores {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .switch-score {
      padding: 15px;
      border-radius: 12px;
      background: rgba(31, 41, 55, 0.5);
    }
    
    .switch-score.p1 { color: #f472b6; }
    .switch-score.p2 { color: #60a5fa; }
    
    .switch-score .name {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .switch-score .points {
      font-size: 28px;
      font-weight: bold;
    }
    
    /* ç»“æœé¡µ */
    .result-page {
      text-align: center;
      padding: 30px 15px;
    }
    
    .result-icon {
      font-size: 70px;
      margin-bottom: 15px;
    }
    
    .result-title {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    
    .result-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .result-stat {
      background: rgba(31, 41, 55, 0.5);
      border-radius: 12px;
      padding: 15px;
    }
    
    .result-stat .value {
      font-size: 28px;
      font-weight: bold;
    }
    
    .result-stat .value.gold { color: #fbbf24; }
    .result-stat .value.green { color: #4ade80; }
    .result-stat .value.orange { color: #fb923c; }
    .result-stat .value.blue { color: #60a5fa; }
    
    .result-stat .label {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 5px;
    }
    
    /* å¤šäººç»“æœ */
    .multi-result {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .multi-result-card {
      border-radius: 16px;
      padding: 20px;
      text-align: center;
    }
    
    .multi-result-card.winner {
      box-shadow: 0 0 0 2px #fbbf24;
    }
    
    .multi-result-card.p1 { background: rgba(219, 39, 119, 0.2); }
    .multi-result-card.p2 { background: rgba(37, 99, 235, 0.2); }
    
    .multi-result-card .medal {
      font-size: 40px;
      margin-bottom: 10px;
    }
    
    .multi-result-card .name {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .multi-result-card .score {
      font-size: 32px;
      font-weight: bold;
      color: #fbbf24;
    }
    
    .multi-result-card .correct-count {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 5px;
    }
    
    /* æ’è¡Œæ¦œè¾“å…¥ */
    .leaderboard-input {
      background: rgba(55, 65, 81, 0.7);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .leaderboard-input p {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 10px;
    }
    
    .leaderboard-input-group {
      display: flex;
      gap: 10px;
    }
    
    .leaderboard-input input {
      flex: 1;
      padding: 10px 15px;
      background: #374151;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
    }
    
    .leaderboard-input input:focus {
      outline: 2px solid #fbbf24;
    }
    
    /* æ’è¡Œæ¦œé¡µé¢ */
    .leaderboard {
      padding: 20px 0;
    }
    
    .leaderboard h2 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 20px;
    }
    
    .leaderboard-empty {
      text-align: center;
      padding: 40px;
      background: rgba(31, 41, 55, 0.5);
      border-radius: 16px;
    }
    
    .leaderboard-empty .icon {
      font-size: 50px;
      margin-bottom: 15px;
    }
    
    .leaderboard-list {
      background: rgba(31, 41, 55, 0.5);
      border-radius: 16px;
      overflow: hidden;
    }
    
    .leaderboard-header {
      display: grid;
      grid-template-columns: 40px 1fr 70px 70px;
      padding: 12px 15px;
      background: rgba(55, 65, 81, 0.5);
      font-size: 13px;
      font-weight: bold;
    }
    
    .leaderboard-item {
      display: grid;
      grid-template-columns: 40px 1fr 70px 70px;
      padding: 12px 15px;
      border-top: 1px solid #374151;
      font-size: 14px;
      align-items: center;
    }
    
    .leaderboard-item.top3 {
      background: rgba(251, 191, 36, 0.1);
    }
    
    .leaderboard-item .rank { text-align: center; }
    .leaderboard-item .name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .leaderboard-item .score { text-align: right; color: #fbbf24; font-weight: bold; }
    .leaderboard-item .date { text-align: right; color: #6b7280; font-size: 12px; }
    
    /* ç­”é¢˜è®°å½• */
    .answer-history {
      background: rgba(31, 41, 55, 0.3);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .answer-history h3 {
      text-align: center;
      margin-bottom: 12px;
      font-size: 15px;
    }
    
    .answer-history-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #374151;
      font-size: 14px;
    }
    
    .answer-history-item:last-child {
      border-bottom: none;
    }
    
    .answer-history-item.correct { color: #4ade80; }
    .answer-history-item.wrong { color: #f87171; }
    
    .answer-history-item .song-info {
      color: white;
    }
    
    .answer-history-item .artist {
      color: #6b7280;
      font-size: 12px;
    }
    
    .result-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .result-buttons .row {
      display: flex;
      gap: 10px;
    }
    
    .result-buttons .row .btn {
      flex: 1;
    }
    
    /* å¤šäººè®¾ç½® */
    .multi-setup {
      padding: 20px 0;
    }
    
    .multi-setup h2 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 20px;
    }
    
    .setup-form {
      background: rgba(31, 41, 55, 0.5);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 8px;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px 15px;
      background: #374151;
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
    }
    
    .form-group input:focus {
      outline: 2px solid #ec4899;
    }
    
    .rules-box {
      background: rgba(17, 24, 39, 0.5);
      border-radius: 10px;
      padding: 12px;
      margin-top: 15px;
    }
    
    .rules-box p {
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .rules-box ul {
      font-size: 12px;
      color: #9ca3af;
      padding-left: 20px;
    }
    
    .rules-box li {
      margin-bottom: 4px;
    }
    
    .difficulty-select {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .diff-btn {
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
      background: #374151;
    }
    
    .diff-btn.active {
      box-shadow: 0 0 0 2px white;
    }
    
    .diff-btn.normal.active {
      background: linear-gradient(135deg, #22c55e, #10b981);
    }
    
    .diff-btn.hard.active {
      background: linear-gradient(135deg, #ef4444, #f43f5e);
    }
    
    /* é¡µé¢æ ‡é¢˜ */
    .page-title {
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    
    .page-subtitle {
      text-align: center;
      color: #9ca3af;
      margin-bottom: 20px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ä¸»èœå• -->
    <div id="menu">
      <div class="logo">ğŸµ</div>
      <h1 class="title">åè¯­R&BçŒœæ­Œç‹</h1>
      <p class="subtitle">å‘¨æ°ä¼¦ Â· ç‹åŠ›å® Â· é™¶å–† Â· æ—ä¿Šæ° Â· æ–¹å¤§åŒ</p>
      
      <div class="artists">
        <div class="artist"><div class="artist-emoji">ğŸ¹</div><div class="artist-name">å‘¨æ°ä¼¦</div></div>
        <div class="artist"><div class="artist-emoji">ğŸ¸</div><div class="artist-name">ç‹åŠ›å®</div></div>
        <div class="artist"><div class="artist-emoji">ğŸ·</div><div class="artist-name">é™¶å–†</div></div>
        <div class="artist"><div class="artist-emoji">ğŸ¤</div><div class="artist-name">æ—ä¿Šæ°</div></div>
        <div class="artist"><div class="artist-emoji">ğŸº</div><div class="artist-name">æ–¹å¤§åŒ</div></div>
      </div>
      
      <div class="menu-buttons">
        <button class="btn btn-primary" onclick="showDifficultySelect()">ğŸ® å•äººæ¨¡å¼</button>
        <button class="btn btn-secondary" onclick="showMultiSetup()">ğŸ‘¥ åŒäººå¯¹æˆ˜</button>
        <button class="btn btn-warning" onclick="showLeaderboard()">ğŸ† æ’è¡Œæ¦œ</button>
      </div>
      
      <p class="dev-credit">å¼€å‘è€…ï¼šç« ä¿Šæ° ğŸ’»</p>
    </div>
    
    <!-- éš¾åº¦é€‰æ‹© -->
    <div id="difficultySelect" class="hidden">
      <h2 class="page-title">é€‰æ‹©éš¾åº¦</h2>
      
      <div class="difficulty-card" style="--color-from: #22c55e; --color-to: #10b981;" onclick="selectDifficulty('normal')">
        <div class="difficulty-icon">ğŸ˜Š</div>
        <div class="difficulty-info">
          <h3>æ™®é€šæ¨¡å¼</h3>
          <p>15ç§’ç­”é¢˜ Â· 4ä¸ªé€‰é¡¹ Â· å¯ç”¨æç¤º</p>
        </div>
      </div>
      
      <div class="difficulty-card" style="--color-from: #ef4444; --color-to: #f43f5e;" onclick="selectDifficulty('hard')">
        <div class="difficulty-icon">ğŸ˜ˆ</div>
        <div class="difficulty-info">
          <h3>å›°éš¾æ¨¡å¼</h3>
          <p>8ç§’ç­”é¢˜ Â· 6ä¸ªé€‰é¡¹ Â· æ›´å¤šéš¾é¢˜</p>
        </div>
      </div>
      
      <button class="btn btn-gray" onclick="showMenu()">è¿”å›ä¸»èœå•</button>
    </div>
    
    <!-- æ¨¡å¼é€‰æ‹© -->
    <div id="modeSelect" class="hidden">
      <h2 class="page-title">é€‰æ‹©æ¸¸æˆæ¨¡å¼</h2>
      <p class="page-subtitle" id="modeSubtitle"></p>
      
      <div class="mode-grid">
        <div class="mode-card" onclick="startGame('LYRICS')">
          <div class="mode-icon">ğŸµ</div>
          <div class="mode-name">æ­Œè¯çŒœæ­Œ</div>
          <div class="mode-desc">çœ‹æ­Œè¯çŒœæ­Œå</div>
        </div>
        <div class="mode-card" onclick="startGame('EMOJI')">
          <div class="mode-icon">ğŸ˜</div>
          <div class="mode-name">è¡¨æƒ…çŒœæ­Œ</div>
          <div class="mode-desc">çœ‹emojiçŒœæ­Œå</div>
        </div>
        <div class="mode-card" onclick="startGame('HINT')">
          <div class="mode-icon">ğŸ’¡</div>
          <div class="mode-name">çº¿ç´¢çŒœæ­Œ</div>
          <div class="mode-desc">æ ¹æ®æç¤ºçŒœæ­Œå</div>
        </div>
        <div class="mode-card" onclick="startGame('FILL')">
          <div class="mode-icon">âœï¸</div>
          <div class="mode-name">æ­Œè¯å¡«ç©º</div>
          <div class="mode-desc">å¡«å†™ç¼ºå¤±æ­Œè¯</div>
        </div>
      </div>
      
      <button class="btn btn-gray" onclick="goBackFromMode()">è¿”å›</button>
    </div>
    
    <!-- å¤šäººè®¾ç½® -->
    <div id="multiSetup" class="hidden multi-setup">
      <h2>ğŸ‘¥ åŒäººå¯¹æˆ˜è®¾ç½®</h2>
      
      <div class="setup-form">
        <div class="form-group">
          <label>ç©å®¶1 åç§°</label>
          <input type="text" id="player1Input" placeholder="ç©å®¶1" maxlength="8">
        </div>
        <div class="form-group">
          <label>ç©å®¶2 åç§°</label>
          <input type="text" id="player2Input" placeholder="ç©å®¶2" maxlength="8">
        </div>
        
        <div class="rules-box">
          <p>ğŸ¯ å¯¹æˆ˜è§„åˆ™ï¼š</p>
          <ul>
            <li>ä¸¤ä½ç©å®¶è½®æµå›ç­”ç›¸åŒçš„é¢˜ç›®</li>
            <li>æ¯é¢˜ä¸¤äººéƒ½ç­”å®Œåè¿›å…¥ä¸‹ä¸€é¢˜</li>
            <li>å…±10é“é¢˜ï¼Œæœ€åæ¯”è¾ƒæ€»åˆ†</li>
          </ul>
        </div>
      </div>
      
      <p class="page-subtitle">é€‰æ‹©éš¾åº¦</p>
      <div class="difficulty-select">
        <button class="diff-btn normal active" id="multiDiffNormal" onclick="setMultiDifficulty('normal')">ğŸ˜Š æ™®é€š</button>
        <button class="diff-btn hard" id="multiDiffHard" onclick="setMultiDifficulty('hard')">ğŸ˜ˆ å›°éš¾</button>
      </div>
      
      <button class="btn btn-secondary" onclick="showModeSelectMulti()">å¼€å§‹å¯¹æˆ˜ âš”ï¸</button>
      <button class="btn btn-gray" style="margin-top: 10px;" onclick="showMenu()">è¿”å›ä¸»èœå•</button>
    </div>
    
    <!-- æ¸¸æˆç•Œé¢ -->
    <div id="gameScreen" class="hidden">
      <div class="game-header">
        <div class="game-stats">
          <span class="stat-badge" id="questionNum">1/10</span>
          <span class="stat-badge score" id="scoreDisplay">â­ 0</span>
          <span class="stat-badge streak hidden" id="streakDisplay">ğŸ”¥ 0è¿å‡»</span>
          <span class="stat-badge player1 hidden" id="currentPlayerBadge"></span>
        </div>
        <div class="timer" id="timerDisplay">â±ï¸ 15s</div>
      </div>
      
      <div class="multi-scores hidden" id="multiScores">
        <div class="multi-score p1" id="p1Score"></div>
        <div class="multi-score p2" id="p2Score"></div>
      </div>
      
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      
      <div style="text-align: center;">
        <span class="mode-badge" id="modeBadge"></span>
      </div>
      
      <div class="question-box">
        <div class="question-label" id="questionLabel"></div>
        <div class="question-content" id="questionContent"></div>
        <div class="fill-input-group hidden" id="fillInputGroup">
          <input type="text" class="fill-input" id="fillInput" placeholder="è¾“å…¥ç­”æ¡ˆ...">
          <button class="btn btn-warning btn-small" onclick="submitFillAnswer()">ç¡®è®¤</button>
        </div>
      </div>
      
      <div style="text-align: center;">
        <button class="hint-btn" id="hintBtn" onclick="useHint()">ğŸ’¡ ä½¿ç”¨æç¤º (-25åˆ†)</button>
        <div class="hint-text hidden" id="hintText"></div>
      </div>
      
      <div class="options-grid" id="optionsGrid"></div>
      
      <div class="answer-result hidden" id="answerResult">
        <div id="answerResultText"></div>
        <div class="answer-text" id="correctAnswerText"></div>
      </div>
      
      <button class="btn btn-primary hidden" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â†’</button>
    </div>
    
    <!-- ç©å®¶åˆ‡æ¢ -->
    <div id="playerSwitch" class="hidden player-switch">
      <div class="player-switch-icon" id="switchIcon">ğŸ®</div>
      <h2 id="switchTitle">è½®åˆ° ç©å®¶1</h2>
      
      <div class="switch-scores">
        <div class="switch-score p1">
          <div class="name" id="switchP1Name">ç©å®¶1</div>
          <div class="points" id="switchP1Score">0</div>
        </div>
        <div class="switch-score p2">
          <div class="name" id="switchP2Name">ç©å®¶2</div>
          <div class="points" id="switchP2Score">0</div>
        </div>
      </div>
      
      <p style="color: #9ca3af; margin-bottom: 20px;" id="switchQuestionNum">ç¬¬ 1/10 é¢˜</p>
      
      <button class="btn btn-success" onclick="continueGame()">å‡†å¤‡å¥½äº†ï¼</button>
    </div>
    
    <!-- ç»“æœé¡µé¢ -->
    <div id="resultScreen" class="hidden result-page">
      <div class="result-icon" id="resultIcon">ğŸ†</div>
      <h2 class="result-title" id="resultTitle">æ¸¸æˆç»“æŸ</h2>
      
      <!-- å•äººç»“æœ -->
      <div id="singleResult">
        <div class="result-stats">
          <div class="result-stat">
            <div class="value gold" id="finalScore">0</div>
            <div class="label">æ€»å¾—åˆ†</div>
          </div>
          <div class="result-stat">
            <div class="value green" id="accuracy">0%</div>
            <div class="label">æ­£ç¡®ç‡</div>
          </div>
          <div class="result-stat">
            <div class="value orange" id="maxStreak">0</div>
            <div class="label">æœ€é«˜è¿å‡»</div>
          </div>
          <div class="result-stat">
            <div class="value blue" id="totalTime">0s</div>
            <div class="label">ç”¨æ—¶</div>
          </div>
        </div>
        
        <div class="leaderboard-input" id="leaderboardInput">
          <p>è¾“å…¥åå­—ä¸Šæ’è¡Œæ¦œ</p>
          <div class="leaderboard-input-group">
            <input type="text" id="nameInput" placeholder="ä½ çš„åå­—..." maxlength="8">
            <button class="btn btn-warning btn-small" onclick="submitScore()">æäº¤</button>
          </div>
        </div>
      </div>
      
      <!-- å¤šäººç»“æœ -->
      <div id="multiResult" class="hidden">
        <div class="multi-result">
          <div class="multi-result-card p1" id="multiP1Card">
            <div class="medal" id="multiP1Medal">ğŸ¥‡</div>
            <div class="name" id="multiP1Name">ç©å®¶1</div>
            <div class="score" id="multiP1Score">0</div>
            <div class="correct-count" id="multiP1Correct">0/0 æ­£ç¡®</div>
          </div>
          <div class="multi-result-card p2" id="multiP2Card">
            <div class="medal" id="multiP2Medal">ğŸ¥ˆ</div>
            <div class="name" id="multiP2Name">ç©å®¶2</div>
            <div class="score" id="multiP2Score">0</div>
            <div class="correct-count" id="multiP2Correct">0/0 æ­£ç¡®</div>
          </div>
        </div>
      </div>
      
      <div class="answer-history" id="answerHistory">
        <h3>ğŸ“ ç­”é¢˜è®°å½•</h3>
        <div id="historyList"></div>
      </div>
      
      <div class="result-buttons">
        <div class="row">
          <button class="btn btn-primary" onclick="playAgain()">å†æ¥ä¸€å±€ ğŸ”„</button>
          <button class="btn btn-gray" onclick="changeMode()">æ¢ä¸ªæ¨¡å¼ ğŸ¯</button>
        </div>
        <button class="btn btn-gray" onclick="showMenu()">è¿”å›ä¸»èœå•</button>
      </div>
      
      <p class="dev-credit">å¼€å‘è€…ï¼šç« ä¿Šæ° ğŸ’»</p>
    </div>
    
    <!-- æ’è¡Œæ¦œ -->
    <div id="leaderboardScreen" class="hidden leaderboard">
      <h2>ğŸ† æ’è¡Œæ¦œ</h2>
      
      <div class="leaderboard-empty" id="leaderboardEmpty">
        <div class="icon">ğŸ“</div>
        <p style="color: #9ca3af;">æš‚æ— è®°å½•</p>
        <p style="font-size: 12px; color: #6b7280; margin-top: 8px;">å®Œæˆæ¸¸æˆåå¯ä»¥ä¸Šæ¦œå“¦ï¼</p>
      </div>
      
      <div class="leaderboard-list hidden" id="leaderboardList">
        <div class="leaderboard-header">
          <div>#</div>
          <div>ç©å®¶</div>
          <div style="text-align: right;">åˆ†æ•°</div>
          <div style="text-align: right;">æ—¥æœŸ</div>
        </div>
        <div id="leaderboardItems"></div>
      </div>
      
      <button class="btn btn-gray" style="margin-top: 20px;" onclick="showMenu()">è¿”å›ä¸»èœå•</button>
    </div>
  </div>

  <script>
    // ==================== æ­Œæ›²æ•°æ®åº“ ====================
    const songDatabase = [
      // å‘¨æ°ä¼¦
      { id: 1, title: "æ™´å¤©", artist: "å‘¨æ°ä¼¦", lyrics: "æ•…äº‹çš„å°é»„èŠ±ï¼Œä»å‡ºç”Ÿé‚£å¹´å°±é£˜ç€", hint: "å…³äºåˆæ‹å’Œå›å¿†çš„ç»å…¸æƒ…æ­Œ", emoji: "â˜€ï¸ğŸŒ¸ğŸ’›", fillBlank: "æ•…äº‹çš„å°___ï¼Œä»å‡ºç”Ÿé‚£å¹´å°±é£˜ç€", answer: "é»„èŠ±", difficulty: "normal" },
      { id: 2, title: "ç¨»é¦™", artist: "å‘¨æ°ä¼¦", lyrics: "å¯¹è¿™ä¸ªä¸–ç•Œå¦‚æœä½ æœ‰å¤ªå¤šçš„æŠ±æ€¨ï¼Œè·Œå€’äº†å°±ä¸æ•¢ç»§ç»­å¾€å‰èµ°", hint: "é¼“åŠ±äººä»¬å›å½’ç®€å•å¿«ä¹çš„ç”°å›­é£æ­Œæ›²", emoji: "ğŸŒ¾ğŸ ğŸ‘¨â€ğŸŒ¾", fillBlank: "è·Œå€’äº†å°±ä¸æ•¢ç»§ç»­å¾€å‰___", answer: "èµ°", difficulty: "normal" },
      { id: 3, title: "ä¸ƒé‡Œé¦™", artist: "å‘¨æ°ä¼¦", lyrics: "çª—å¤–çš„éº»é›€åœ¨ç”µçº¿æ†ä¸Šå¤šå˜´ï¼Œä½ è¯´è¿™ä¸€å¥å¾ˆæœ‰å¤å¤©çš„æ„Ÿè§‰", hint: "ä»¥ä¸€ç§èŠ±å‘½åçš„å¤æ—¥æ‹æ›²", emoji: "ğŸŒºğŸ¦âš¡", fillBlank: "çª—å¤–çš„___åœ¨ç”µçº¿æ†ä¸Šå¤šå˜´", answer: "éº»é›€", difficulty: "normal" },
      { id: 4, title: "é’èŠ±ç“·", artist: "å‘¨æ°ä¼¦", lyrics: "å¤©é’è‰²ç­‰çƒŸé›¨ï¼Œè€Œæˆ‘åœ¨ç­‰ä½ ", hint: "ä¸­å›½é£ä»£è¡¨ä½œï¼Œæ­Œåæ˜¯ä¸€ç§ç“·å™¨", emoji: "ğŸºğŸ’™ğŸ¨", fillBlank: "å¤©é’è‰²ç­‰___ï¼Œè€Œæˆ‘åœ¨ç­‰ä½ ", answer: "çƒŸé›¨", difficulty: "normal" },
      { id: 5, title: "å¤œæ›²", artist: "å‘¨æ°ä¼¦", lyrics: "ä¸€ç¾¤å—œè¡€çš„èš‚èšï¼Œè¢«è…è‚‰æ‰€å¸å¼•", hint: "æš—é»‘é£æ ¼çš„é’¢ç´æ›²é£æƒ…æ­Œ", emoji: "ğŸŒ™ğŸ¹ğŸ–¤", fillBlank: "ä¸€ç¾¤å—œè¡€çš„___ï¼Œè¢«è…è‚‰æ‰€å¸å¼•", answer: "èš‚èš", difficulty: "hard" },
      { id: 6, title: "ç®€å•çˆ±", artist: "å‘¨æ°ä¼¦", lyrics: "è¯´ä¸ä¸Šä¸ºä»€ä¹ˆï¼Œæˆ‘å˜å¾—å¾ˆä¸»åŠ¨", hint: "æ—©æœŸç”œèœœæƒ…æ­Œï¼Œæ­Œåä¸¤ä¸ªå­—å½¢å®¹çˆ±æƒ…", emoji: "ğŸ’•ğŸ˜Šâœ¨", fillBlank: "è¯´ä¸ä¸Šä¸ºä»€ä¹ˆï¼Œæˆ‘å˜å¾—å¾ˆ___", answer: "ä¸»åŠ¨", difficulty: "normal" },
      { id: 7, title: "å‘Šç™½æ°”çƒ", artist: "å‘¨æ°ä¼¦", lyrics: "å¡çº³æ²³ç•”å·¦å²¸çš„å’–å•¡ï¼Œæˆ‘æ‰‹ä¸€æ¯å“å°ä½ çš„ç¾", hint: "æµªæ¼«æ³•å¼é£æƒ…çš„å‘Šç™½æ­Œæ›²", emoji: "ğŸˆğŸ’ğŸ—¼", fillBlank: "å¡çº³æ²³ç•”å·¦å²¸çš„___", answer: "å’–å•¡", difficulty: "normal" },
      { id: 8, title: "åŒæˆªæ£", artist: "å‘¨æ°ä¼¦", lyrics: "å¿«ä½¿ç”¨åŒæˆªæ£ï¼Œå“¼å“¼å“ˆå…®", hint: "èåˆä¸­å›½åŠŸå¤«å…ƒç´ çš„å˜»å“ˆæ­Œæ›²", emoji: "ğŸ¥‹ğŸ’ªğŸ”¥", fillBlank: "å¿«ä½¿ç”¨åŒæˆªæ£ï¼Œ___å“ˆå…®", answer: "å“¼å“¼", difficulty: "normal" },
      { id: 9, title: "é¾™å·é£", artist: "å‘¨æ°ä¼¦", lyrics: "çˆ±æƒ…æ¥çš„å¤ªå¿«å°±åƒé¾™å·é£", hint: "ç”¨è‡ªç„¶ç¾å®³æ¯”å–»çˆ±æƒ…çš„é€Ÿåº¦", emoji: "ğŸŒªï¸â¤ï¸ğŸ’¨", fillBlank: "çˆ±æƒ…æ¥çš„å¤ªå¿«å°±åƒ___", answer: "é¾™å·é£", difficulty: "normal" },
      { id: 10, title: "å®‰é™", artist: "å‘¨æ°ä¼¦", lyrics: "åªå‰©ä¸‹é’¢ç´é™ªæˆ‘è°ˆäº†ä¸€å¤©", hint: "å¤±æ‹åç‹¬è‡ªç–—ä¼¤çš„æ…¢æ­Œ", emoji: "ğŸ¤«ğŸ¹ğŸ˜¢", fillBlank: "åªå‰©ä¸‹é’¢ç´é™ªæˆ‘è°ˆäº†ä¸€___", answer: "å¤©", difficulty: "hard" },
      { id: 11, title: "ä»¥çˆ¶ä¹‹å", artist: "å‘¨æ°ä¼¦", lyrics: "ä½å¤´äº²å»æˆ‘çš„å·¦æ‰‹ï¼Œæ¢å–è¢«å®½æ•çš„æ‰¿è¯º", hint: "é»‘æš—å®—æ•™é£æ ¼çš„å²è¯—çº§ä½œå“", emoji: "âœï¸ğŸ–¤ğŸ­", fillBlank: "ä½å¤´äº²å»æˆ‘çš„___æ‰‹", answer: "å·¦", difficulty: "hard" },
      { id: 12, title: "å‘å¦‚é›ª", artist: "å‘¨æ°ä¼¦", lyrics: "ä½ å‘å¦‚é›ªå‡„ç¾äº†ç¦»åˆ«ï¼Œæˆ‘ç„šé¦™æ„ŸåŠ¨äº†è°", hint: "ä¸­å›½é£æ‚²æƒ…æ­Œæ›²ï¼Œå½¢å®¹å¤´å‘çš„é¢œè‰²", emoji: "â„ï¸ğŸ’‡â€â™€ï¸ğŸ˜­", fillBlank: "ä½ å‘å¦‚é›ªå‡„ç¾äº†___", answer: "ç¦»åˆ«", difficulty: "hard" },
      
      // ç‹åŠ›å®
      { id: 13, title: "ä½ ä¸çŸ¥é“çš„äº‹", artist: "ç‹åŠ›å®", lyrics: "è´è¶çœ¨å‡ æ¬¡çœ¼ç›ï¼Œæ‰å­¦ä¼šé£è¡Œ", hint: "ç”µå½±ã€Šæ‹çˆ±é€šå‘Šã€‹ä¸»é¢˜æ›²", emoji: "ğŸ¦‹ğŸ‘€â¤ï¸", fillBlank: "è´è¶çœ¨å‡ æ¬¡çœ¼ç›ï¼Œæ‰å­¦ä¼š___", answer: "é£è¡Œ", difficulty: "normal" },
      { id: 14, title: "å”¯ä¸€", artist: "ç‹åŠ›å®", lyrics: "ä½ æ˜¯æˆ‘çš„å”¯ä¸€ï¼Œä¸¤ä¸ªä¸–ç•Œéƒ½å˜å½¢", hint: "ç»å…¸æ·±æƒ…æ…¢æ­Œï¼Œæ­Œåè¡¨ç¤ºç‹¬ä¸€æ— äºŒ", emoji: "1ï¸âƒ£ğŸ’–ğŸŒ", fillBlank: "ä½ æ˜¯æˆ‘çš„å”¯ä¸€ï¼Œä¸¤ä¸ªä¸–ç•Œéƒ½___", answer: "å˜å½¢", difficulty: "normal" },
      { id: 15, title: "å¤§åŸå°çˆ±", artist: "ç‹åŠ›å®", lyrics: "åŸé‡Œçš„æœˆå…‰æŠŠæ¢¦ç…§äº®ï¼Œè¯·æ¸©æš–ä»–å¿ƒæˆ¿", hint: "å…³äºéƒ½å¸‚çˆ±æƒ…çš„æ¸©æš–æ­Œæ›²", emoji: "ğŸ™ï¸ğŸŒ™ğŸ’‘", fillBlank: "åŸé‡Œçš„æœˆå…‰æŠŠæ¢¦___", answer: "ç…§äº®", difficulty: "normal" },
      { id: 16, title: "è½å¶å½’æ ¹", artist: "ç‹åŠ›å®", lyrics: "æˆ‘å‘ä½ é£ï¼Œå¤šè¿œéƒ½ä¸ç´¯", hint: "å…³äºæ€ä¹¡å’Œå½’å±æ„Ÿçš„æ­Œ", emoji: "ğŸ‚ğŸŒ³ğŸ ", fillBlank: "æˆ‘å‘ä½ é£ï¼Œå¤šè¿œéƒ½ä¸___", answer: "ç´¯", difficulty: "normal" },
      { id: 17, title: "å¿ƒè·³", artist: "ç‹åŠ›å®", lyrics: "å¿ƒè·³è§¦åŠ¨ç€æ˜Ÿçƒçš„è„‰æ", hint: "èŠ‚å¥æ„Ÿå¼ºçƒˆï¼Œæ­Œåæ˜¯èº«ä½“çš„å¾‹åŠ¨", emoji: "ğŸ’“ğŸŒŸğŸŒ", fillBlank: "å¿ƒè·³è§¦åŠ¨ç€æ˜Ÿçƒçš„___", answer: "è„‰æ", difficulty: "hard" },
      { id: 18, title: "èŠ±ç”°é”™", artist: "ç‹åŠ›å®", lyrics: "èŠ±ç”°é‡ŒçŠ¯äº†é”™ï¼Œè¯´å¥½ç ´æ™“å‰å¿˜æ‰", hint: "ä¸­å›½é£æ­Œæ›²ï¼Œåœ¨èŠ±ç”°é‡Œå‘ç”Ÿçš„æ•…äº‹", emoji: "ğŸŒ¸ğŸŒ¾ğŸ˜¢", fillBlank: "èŠ±ç”°é‡ŒçŠ¯äº†é”™ï¼Œè¯´å¥½___å‰å¿˜æ‰", answer: "ç ´æ™“", difficulty: "hard" },
      { id: 19, title: "ç›–ä¸–è‹±é›„", artist: "ç‹åŠ›å®", lyrics: "è®©æˆ‘ä»¬ä¸€èµ·æ‘‡æ‘†ï¼Œä¸€èµ·å—¨", hint: "åŒåä¸“è¾‘ä¸»æ‰“æ­Œï¼Œå¾ˆå—¨çš„èˆæ›²", emoji: "ğŸ¦¸â€â™‚ï¸ğŸ’«ğŸ¤", fillBlank: "è®©æˆ‘ä»¬ä¸€èµ·___ï¼Œä¸€èµ·å—¨", answer: "æ‘‡æ‘†", difficulty: "normal" },
      { id: 20, title: "æ”¹å˜è‡ªå·±", artist: "ç‹åŠ›å®", lyrics: "æˆ‘å¯ä»¥æ”¹å˜ä¸–ç•Œï¼Œæ”¹å˜è‡ªå·±", hint: "åŠ±å¿—æ­Œæ›²ï¼Œé¼“åŠ±è‡ªæˆ‘æ”¹å˜", emoji: "ğŸ”„ğŸ’ªğŸŒ", fillBlank: "æˆ‘å¯ä»¥æ”¹å˜ä¸–ç•Œï¼Œæ”¹å˜___", answer: "è‡ªå·±", difficulty: "normal" },
      { id: 21, title: "é¾™çš„ä¼ äºº", artist: "ç‹åŠ›å®", lyrics: "å¤è€çš„ä¸œæ–¹æœ‰ä¸€æ¡é¾™ï¼Œå®ƒçš„åå­—å°±å«ä¸­å›½", hint: "ç»å…¸çˆ±å›½æ­Œæ›²çš„ç°ä»£ç‰ˆ", emoji: "ğŸ‰ğŸ‡¨ğŸ‡³ğŸ”¥", fillBlank: "å¤è€çš„ä¸œæ–¹æœ‰ä¸€æ¡___", answer: "é¾™", difficulty: "normal" },
      
      // é™¶å–†
      { id: 22, title: "æ™®é€šæœ‹å‹", artist: "é™¶å–†", lyrics: "æœ‹å‹æˆ‘å½“ä½ æ˜¯æœ‹å‹ï¼Œä½ å´å½“æˆ‘æ˜¯æ™®é€šæœ‹å‹", hint: "å…³äºå‹æƒ…ä»¥ä¸Šæ‹äººæœªæ»¡çš„å°´å°¬å…³ç³»", emoji: "ğŸ‘«â“ğŸ’”", fillBlank: "ä½ å´å½“æˆ‘æ˜¯___æœ‹å‹", answer: "æ™®é€š", difficulty: "normal" },
      { id: 23, title: "çˆ±å¾ˆç®€å•", artist: "é™¶å–†", lyrics: "æˆ‘æƒ³å¤§å£°å®£å¸ƒå¯¹ä½ ä¾ä¾ä¸èˆ", hint: "R&Bç»å…¸æƒ…æ­Œï¼Œæ­Œåè¯´çˆ±æƒ…å…¶å®ä¸å¤æ‚", emoji: "â¤ï¸âœ¨ğŸ˜Œ", fillBlank: "æˆ‘æƒ³å¤§å£°å®£å¸ƒå¯¹ä½ ___", answer: "ä¾ä¾ä¸èˆ", difficulty: "normal" },
      { id: 24, title: "æµæ²™", artist: "é™¶å–†", lyrics: "æˆ‘æ…¢æ…¢çš„æŠŠä½ æ”¾ä¸‹ï¼Œåƒæµæ²™", hint: "å¤±æ‹çš„æ„Ÿè§‰åƒæŸç§ä¼šæµåŠ¨çš„æ²™", emoji: "â³ğŸ’¨ğŸ˜", fillBlank: "æˆ‘æ…¢æ…¢çš„æŠŠä½ ___ï¼Œåƒæµæ²™", answer: "æ”¾ä¸‹", difficulty: "normal" },
      { id: 25, title: "Susanè¯´", artist: "é™¶å–†", lyrics: "Susanè¯´å¥¹ä¸çˆ±ä½ ï¼ŒSusanè¯´", hint: "æ­Œåæ˜¯ä¸€ä¸ªè‹±æ–‡å¥³ç”Ÿåå­—", emoji: "ğŸ‘©ğŸ’¬ğŸš«", fillBlank: "___è¯´å¥¹ä¸çˆ±ä½ ", answer: "Susan", difficulty: "normal" },
      { id: 26, title: "æ‰¾è‡ªå·±", artist: "é™¶å–†", lyrics: "æˆ‘åˆ°åº•æ˜¯è°ï¼Œèƒ½ä¸èƒ½å¼€ç€é£æœºå»è¿½", hint: "å…³äºè‡ªæˆ‘æ¢ç´¢çš„æ­Œæ›²", emoji: "ğŸ”ğŸ‘¤âœˆï¸", fillBlank: "èƒ½ä¸èƒ½å¼€ç€___å»è¿½", answer: "é£æœº", difficulty: "hard" },
      { id: 27, title: "é»‘è‰²æŸ³ä¸", artist: "é™¶å–†", lyrics: "é»‘è‰²æŸ³ä¸ï¼Œæˆ‘çœ‹æˆ‘è‡ªå·±", hint: "åŒåä¸“è¾‘ï¼Œä¸€ç§é»‘è‰²çš„æ°´æœ", emoji: "ğŸŠâ¬›ğŸ‘ï¸", fillBlank: "é»‘è‰²æŸ³ä¸ï¼Œæˆ‘çœ‹æˆ‘___", answer: "è‡ªå·±", difficulty: "hard" },
      { id: 28, title: "å¤©å¤©", artist: "é™¶å–†", lyrics: "å¤©å¤©æƒ³ä½ ï¼Œå¤©å¤©é—®è‡ªå·±", hint: "æ¯ä¸€å¤©éƒ½åœ¨æƒ³å¿µï¼Œæ­Œåé‡å¤ä¸€ä¸ªå­—", emoji: "ğŸ“…ğŸ’­â¤ï¸", fillBlank: "å¤©å¤©æƒ³ä½ ï¼Œå¤©å¤©é—®___", answer: "è‡ªå·±", difficulty: "normal" },
      
      // æ—ä¿Šæ°
      { id: 29, title: "æ±Ÿå—", artist: "æ—ä¿Šæ°", lyrics: "é£åˆ°è¿™é‡Œå°±æ˜¯ç²˜ï¼Œç²˜ä½è¿‡å®¢çš„æ€å¿µ", hint: "ä»¥ä¸­å›½å—æ–¹åœ°åŒºå‘½åçš„ç»å…¸æ­Œæ›²", emoji: "ğŸŒŠğŸ¯ğŸ’¨", fillBlank: "ç²˜ä½è¿‡å®¢çš„___", answer: "æ€å¿µ", difficulty: "normal" },
      { id: 30, title: "å¥¹è¯´", artist: "æ—ä¿Šæ°", lyrics: "å¥¹è¯´æ— æ‰€è°“ï¼Œåªè¦èƒ½åœ¨å¤œé‡Œç¿»æ¥è¦†å»çš„æ—¶å€™æœ‰å¯„æ‰˜", hint: "å­™ç‡•å§¿ä½œè¯ï¼Œæ­Œåä¸¤ä¸ªå­—", emoji: "ğŸ‘©ğŸ’¬ğŸ˜¢", fillBlank: "å¥¹è¯´___", answer: "æ— æ‰€è°“", difficulty: "hard" },
      { id: 31, title: "ä¿®ç‚¼çˆ±æƒ…", artist: "æ—ä¿Šæ°", lyrics: "ä¿®ç‚¼çˆ±æƒ…çš„å¿ƒé…¸ï¼Œå­¦ä¼šæ”¾å¥½ä»¥å‰çš„æ¸´æœ›", hint: "æŠŠçˆ±æƒ…æ¯”ä½œéœ€è¦ç»ƒä¹ çš„åŠŸè¯¾", emoji: "âš”ï¸â¤ï¸ğŸ“š", fillBlank: "å­¦ä¼šæ”¾å¥½ä»¥å‰çš„___", answer: "æ¸´æœ›", difficulty: "normal" },
      { id: 32, title: "å¯æƒœæ²¡å¦‚æœ", artist: "æ—ä¿Šæ°", lyrics: "å‡å¦‚æŠŠçŠ¯å¾—èµ·çš„é”™ï¼Œèƒ½é”™çš„éƒ½é”™è¿‡", hint: "æ„Ÿå¹äººç”Ÿæ²¡æœ‰å¦‚æœçš„é—æ†¾æƒ…æ­Œ", emoji: "ğŸ˜”ğŸ’­âŒ", fillBlank: "èƒ½é”™çš„éƒ½___", answer: "é”™è¿‡", difficulty: "normal" },
      { id: 33, title: "å°é…’çª", artist: "æ—ä¿Šæ°", lyrics: "å°é…’çªé•¿ç«æ¯›ï¼Œæ˜¯ä½ æœ€ç¾çš„è®°å·", hint: "å’Œè”¡å“å¦åˆå”±ï¼Œå”±è„¸ä¸Šçš„ä¸€ä¸ªç‰¹å¾", emoji: "ğŸ˜ŠğŸ‘ï¸ğŸ’•", fillBlank: "æ˜¯ä½ æœ€ç¾çš„___", answer: "è®°å·", difficulty: "normal" },
      { id: 34, title: "ä¸€åƒå¹´ä»¥å", artist: "æ—ä¿Šæ°", lyrics: "ä¸€åƒå¹´ä»¥åï¼Œä¸–ç•Œæ—©å·²æ²¡æœ‰æˆ‘", hint: "ç©¿è¶Šæ¼«é•¿æ—¶å…‰çš„çˆ±æƒ…æ‰¿è¯º", emoji: "â°ğŸŒğŸ’”", fillBlank: "ä¸–ç•Œæ—©å·²æ²¡æœ‰___", answer: "æˆ‘", difficulty: "normal" },
      { id: 35, title: "æ›¹æ“", artist: "æ—ä¿Šæ°", lyrics: "ä¸æ˜¯è‹±é›„ä¸è¯»ä¸‰å›½", hint: "ä»¥ä¸‰å›½äººç‰©å‘½åçš„æ­Œ", emoji: "ğŸ´âš”ï¸ğŸ“–", fillBlank: "ä¸æ˜¯___ä¸è¯»ä¸‰å›½", answer: "è‹±é›„", difficulty: "normal" },
      { id: 36, title: "èƒŒå¯¹èƒŒæ‹¥æŠ±", artist: "æ—ä¿Šæ°", lyrics: "èƒŒå¯¹èƒŒæ‹¥æŠ±ï¼Œæ»‘è½è‚©å¤´éš¾è¿‡éƒ½ä¸è®²", hint: "ä¸€ç§ç‰¹æ®Šçš„æ‹¥æŠ±æ–¹å¼", emoji: "ğŸ”™ğŸ¤—ğŸ’”", fillBlank: "æ»‘è½è‚©å¤´éš¾è¿‡éƒ½ä¸___", answer: "è®²", difficulty: "normal" },
      { id: 37, title: "é†‰èµ¤å£", artist: "æ—ä¿Šæ°", lyrics: "ç¡®è®¤è¿‡çœ¼ç¥ï¼Œæˆ‘é‡ä¸Šå¯¹çš„äºº", hint: "ä¸‰å›½ä¸»é¢˜ï¼Œæˆ˜åœºåœ¨èµ¤å£", emoji: "ğŸ·ğŸ”¥âš”ï¸", fillBlank: "æˆ‘é‡ä¸Šå¯¹çš„___", answer: "äºº", difficulty: "hard" },
      { id: 38, title: "å­¦ä¸ä¼š", artist: "æ—ä¿Šæ°", lyrics: "æ€ä¹ˆå­¦éƒ½å­¦ä¸ä¼šï¼Œå¦‚ä½•èˆå¼ƒ", hint: "å…³äºæ”¾ä¸ä¸‹çš„æ— å¥ˆ", emoji: "ğŸ“šâŒğŸ˜¢", fillBlank: "æ€ä¹ˆå­¦éƒ½å­¦ä¸ä¼šï¼Œå¦‚ä½•___", answer: "èˆå¼ƒ", difficulty: "hard" },
      
      // æ–¹å¤§åŒ
      { id: 39, title: "çˆ±çˆ±çˆ±", artist: "æ–¹å¤§åŒ", lyrics: "çˆ±çˆ±çˆ±ï¼Œçˆ±åˆ°è¦å", hint: "æ­Œåæ˜¯åŒä¸€ä¸ªå­—é‡å¤ä¸‰æ¬¡", emoji: "â¤ï¸â¤ï¸â¤ï¸ğŸ¤¢", fillBlank: "çˆ±çˆ±çˆ±ï¼Œçˆ±åˆ°è¦___", answer: "å", difficulty: "normal" },
      { id: 40, title: "ä¸‰äººæ¸¸", artist: "æ–¹å¤§åŒ", lyrics: "ä½ çˆ±çš„æ˜¯ä»–ï¼Œä»–çˆ±çš„æ˜¯ä½ ï¼Œæˆ‘åœ¨ä¸­é—´", hint: "å…³äºä¸‰è§’æ‹çš„æ­Œï¼Œä¸‰ä¸ªäººçš„æ•…äº‹", emoji: "ğŸ‘¤ğŸ‘¤ğŸ‘¤ğŸ”º", fillBlank: "æˆ‘åœ¨___", answer: "ä¸­é—´", difficulty: "normal" },
      { id: 41, title: "çº¢è±†", artist: "æ–¹å¤§åŒ", lyrics: "è¿˜æ²¡å¥½å¥½çš„æ„Ÿå—ï¼Œé›ªèŠ±ç»½æ”¾çš„æ°”å€™", hint: "ç¿»å”±ç‹è²ç»å…¸ï¼Œä»¥ä¸€ç§è±†å­å‘½å", emoji: "ğŸ«˜â¤ï¸â„ï¸", fillBlank: "é›ªèŠ±ç»½æ”¾çš„___", answer: "æ°”å€™", difficulty: "normal" },
      { id: 42, title: "ç‰¹åˆ«çš„äºº", artist: "æ–¹å¤§åŒ", lyrics: "å› ä¸ºä½ æ˜¯ç‰¹åˆ«çš„äººï¼Œæ‰€ä»¥ç‰¹åˆ«ç‹ å¿ƒ", hint: "å› ä¸ºç‰¹åˆ«æ‰€ä»¥ä¼¤å¾—ç‰¹åˆ«æ·±", emoji: "â­ğŸ‘¤ğŸ’”", fillBlank: "æ‰€ä»¥ç‰¹åˆ«___", answer: "ç‹ å¿ƒ", difficulty: "hard" },
      { id: 43, title: "æ˜¥é£å¹", artist: "æ–¹å¤§åŒ", lyrics: "æ˜¥é£å¹åˆç”Ÿï¼Œçˆ±æƒ…çŠ¯äº†ç—…", hint: "æ˜¥å¤©çš„é£åœ¨å¹ï¼Œé‡ç«çƒ§ä¸å°½", emoji: "ğŸŒ¸ğŸ’¨ğŸŒ±", fillBlank: "çˆ±æƒ…çŠ¯äº†___", answer: "ç—…", difficulty: "normal" },
      { id: 44, title: "å¦‚æœçˆ±", artist: "æ–¹å¤§åŒ", lyrics: "å¦‚æœçˆ±ï¼Œè¯·æ·±çˆ±", hint: "ç”µè§†å‰§åŒåä¸»é¢˜æ›²ï¼Œå‡è®¾æ€§çš„çˆ±", emoji: "â“â¤ï¸ğŸ’¯", fillBlank: "å¦‚æœçˆ±ï¼Œè¯·___çˆ±", answer: "æ·±", difficulty: "normal" },
    ];
    
    const artistEmoji = {
      "å‘¨æ°ä¼¦": "ğŸ¹", "ç‹åŠ›å®": "ğŸ¸", "é™¶å–†": "ğŸ·", "æ—ä¿Šæ°": "ğŸ¤", "æ–¹å¤§åŒ": "ğŸº"
    };
    
    const artistColors = {
      "å‘¨æ°ä¼¦": "#8b5cf6", "ç‹åŠ›å®": "#f97316", "é™¶å–†": "#14b8a6", "æ—ä¿Šæ°": "#eab308", "æ–¹å¤§åŒ": "#ec4899"
    };
    
    // ==================== æ¸¸æˆçŠ¶æ€ ====================
    let gameState = {
      mode: 'single',
      selectedMode: null,
      difficulty: 'normal',
      questions: [],
      currentQuestion: 0,
      score: 0,
      streak: 0,
      maxStreak: 0,
      totalTime: 0,
      timeLeft: 15,
      timer: null,
      showingAnswer: false,
      hintsUsed: 0,
      showingHint: false,
      answeredQuestions: [],
      // å¤šäºº
      currentPlayer: 1,
      player1Name: 'ç©å®¶1',
      player2Name: 'ç©å®¶2',
      player1Score: 0,
      player2Score: 0,
      player1Answers: [],
      player2Answers: [],
    };
    
    let leaderboard = [];
    
    // ==================== å·¥å…·å‡½æ•° ====================
    function shuffleArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }
    
    function $(id) { return document.getElementById(id); }
    
    function showScreen(screenId) {
      const screens = ['menu', 'difficultySelect', 'modeSelect', 'multiSetup', 'gameScreen', 'playerSwitch', 'resultScreen', 'leaderboardScreen'];
      screens.forEach(id => {
        $(id).classList.toggle('hidden', id !== screenId);
      });
    }
    
    function getDiffConfig() {
      return gameState.difficulty === 'hard' 
        ? { time: 8, options: 6 } 
        : { time: 15, options: 4 };
    }
    
    // ==================== å¯¼èˆªå‡½æ•° ====================
    function showMenu() {
      clearInterval(gameState.timer);
      showScreen('menu');
    }
    
    function showDifficultySelect() {
      showScreen('difficultySelect');
    }
    
    function selectDifficulty(diff) {
      gameState.difficulty = diff;
      gameState.mode = 'single';
      $('modeSubtitle').textContent = diff === 'hard' ? 'ğŸ˜ˆ å›°éš¾æ¨¡å¼' : 'ğŸ˜Š æ™®é€šæ¨¡å¼';
      showScreen('modeSelect');
    }
    
    function showMultiSetup() {
      showScreen('multiSetup');
    }
    
    function setMultiDifficulty(diff) {
      gameState.difficulty = diff;
      $('multiDiffNormal').classList.toggle('active', diff === 'normal');
      $('multiDiffHard').classList.toggle('active', diff === 'hard');
    }
    
    function showModeSelectMulti() {
      gameState.mode = 'multi';
      gameState.player1Name = $('player1Input').value || 'ç©å®¶1';
      gameState.player2Name = $('player2Input').value || 'ç©å®¶2';
      $('modeSubtitle').textContent = `ğŸ‘¥ ${gameState.player1Name} VS ${gameState.player2Name}`;
      showScreen('modeSelect');
    }
    
    function goBackFromMode() {
      showScreen(gameState.mode === 'multi' ? 'multiSetup' : 'difficultySelect');
    }
    
    function showLeaderboard() {
      renderLeaderboard();
      showScreen('leaderboardScreen');
    }
    
    // ==================== æ¸¸æˆé€»è¾‘ ====================
    function startGame(mode) {
      gameState.selectedMode = mode;
      gameState.questions = shuffleArray(songDatabase).slice(0, 10);
      gameState.currentQuestion = 0;
      gameState.score = 0;
      gameState.streak = 0;
      gameState.maxStreak = 0;
      gameState.totalTime = 0;
      gameState.hintsUsed = 0;
      gameState.showingHint = false;
      gameState.showingAnswer = false;
      gameState.answeredQuestions = [];
      gameState.currentPlayer = 1;
      gameState.player1Score = 0;
      gameState.player2Score = 0;
      gameState.player1Answers = [];
      gameState.player2Answers = [];
      
      showScreen('gameScreen');
      setupGameUI();
      loadQuestion();
      startTimer();
    }
    
    function setupGameUI() {
      const isMulti = gameState.mode === 'multi';
      const diffConfig = getDiffConfig();
      
      // å¤šäººç›¸å…³UI
      $('multiScores').classList.toggle('hidden', !isMulti);
      $('currentPlayerBadge').classList.toggle('hidden', !isMulti);
      
      if (isMulti) {
        $('p1Score').textContent = `${gameState.player1Name}: 0`;
        $('p2Score').textContent = `${gameState.player2Name}: 0`;
      }
      
      // æ¨¡å¼æ ‡ç­¾
      const modeNames = { LYRICS: 'ğŸµ æ­Œè¯çŒœæ­Œ', EMOJI: 'ğŸ˜ è¡¨æƒ…çŒœæ­Œ', HINT: 'ğŸ’¡ çº¿ç´¢çŒœæ­Œ', FILL: 'âœï¸ æ­Œè¯å¡«ç©º' };
      $('modeBadge').textContent = modeNames[gameState.selectedMode];
      
      // æç¤ºæŒ‰é’®
      $('hintBtn').classList.toggle('hidden', gameState.selectedMode === 'HINT' || gameState.selectedMode === 'FILL' || gameState.difficulty === 'hard');
    }
    
    function loadQuestion() {
      const song = gameState.questions[gameState.currentQuestion];
      const diffConfig = getDiffConfig();
      const isMulti = gameState.mode === 'multi';
      
      // æ›´æ–°è¿›åº¦
      $('questionNum').textContent = `${gameState.currentQuestion + 1}/10`;
      $('progressFill').style.width = `${(gameState.currentQuestion / 10) * 100}%`;
      
      // æ›´æ–°åˆ†æ•°
      if (isMulti) {
        $('scoreDisplay').textContent = `â­ ${gameState.currentPlayer === 1 ? gameState.player1Score : gameState.player2Score}`;
        $('currentPlayerBadge').textContent = gameState.currentPlayer === 1 ? gameState.player1Name : gameState.player2Name;
        $('currentPlayerBadge').className = `stat-badge ${gameState.currentPlayer === 1 ? 'player1' : 'player2'}`;
        $('p1Score').textContent = `${gameState.player1Name}: ${gameState.player1Score}`;
        $('p2Score').textContent = `${gameState.player2Name}: ${gameState.player2Score}`;
        $('p1Score').classList.toggle('active', gameState.currentPlayer === 1);
        $('p2Score').classList.toggle('active', gameState.currentPlayer === 2);
      } else {
        $('scoreDisplay').textContent = `â­ ${gameState.score}`;
      }
      
      // è¿å‡»
      $('streakDisplay').classList.toggle('hidden', gameState.streak <= 1);
      $('streakDisplay').textContent = `ğŸ”¥ ${gameState.streak}è¿å‡»`;
      
      // é¢˜ç›®å†…å®¹
      renderQuestion(song);
      
      // ç”Ÿæˆé€‰é¡¹
      if (gameState.selectedMode !== 'FILL') {
        renderOptions(song, diffConfig.options);
      }
      
      // é‡ç½®çŠ¶æ€
      $('answerResult').classList.add('hidden');
      $('nextBtn').classList.add('hidden');
      $('hintText').classList.add('hidden');
      $('hintBtn').disabled = false;
      $('hintBtn').textContent = 'ğŸ’¡ ä½¿ç”¨æç¤º (-25åˆ†)';
      gameState.showingHint = false;
      gameState.showingAnswer = false;
    }
    
    function renderQuestion(song) {
      const labels = { LYRICS: 'æ ¹æ®æ­Œè¯çŒœæ­Œå', EMOJI: 'æ ¹æ®è¡¨æƒ…çŒœæ­Œå', HINT: 'æ ¹æ®çº¿ç´¢çŒœæ­Œå', FILL: 'å¡«å†™ç¼ºå¤±çš„æ­Œè¯' };
      $('questionLabel').textContent = labels[gameState.selectedMode];
      
      $('fillInputGroup').classList.add('hidden');
      $('optionsGrid').classList.remove('hidden');
      
      switch (gameState.selectedMode) {
        case 'LYRICS':
          $('questionContent').innerHTML = `"${song.lyrics}"`;
          $('questionContent').className = 'question-content';
          break;
        case 'EMOJI':
          $('questionContent').innerHTML = song.emoji;
          $('questionContent').className = 'question-content question-emoji';
          break;
        case 'HINT':
          $('questionContent').innerHTML = `ğŸ’¡ ${song.hint}`;
          $('questionContent').className = 'question-content';
          break;
        case 'FILL':
          const parts = song.fillBlank.split('___');
          $('questionContent').innerHTML = parts[0] + '<span style="border-bottom: 2px solid #fbbf24; padding: 0 20px; margin: 0 5px;">___</span>' + (parts[1] || '');
          $('questionContent').className = 'question-content';
          $('fillInputGroup').classList.remove('hidden');
          $('optionsGrid').classList.add('hidden');
          $('fillInput').value = '';
          $('fillInput').focus();
          break;
      }
    }
    
    function renderOptions(correctSong, optionCount) {
      const otherSongs = songDatabase.filter(s => s.id !== correctSong.id);
      const wrongOptions = shuffleArray(otherSongs).slice(0, optionCount - 1);
      const allOptions = shuffleArray([correctSong, ...wrongOptions]);
      
      const grid = $('optionsGrid');
      grid.className = optionCount === 6 ? 'options-grid six-options' : 'options-grid';
      grid.innerHTML = allOptions.map(song => `
        <button class="option-btn" data-id="${song.id}" onclick="selectOption(${song.id})">
          <div class="option-title">${song.title}</div>
          <div class="option-artist">${artistEmoji[song.artist]} ${song.artist}</div>
        </button>
      `).join('');
    }
    
    function startTimer() {
      clearInterval(gameState.timer);
      const diffConfig = getDiffConfig();
      gameState.timeLeft = diffConfig.time;
      updateTimerDisplay();
      
      gameState.timer = setInterval(() => {
        if (!gameState.showingAnswer) {
          gameState.timeLeft--;
          gameState.totalTime++;
          updateTimerDisplay();
          
          if (gameState.timeLeft <= 0) {
            handleTimeout();
          }
        }
      }, 1000);
    }
    
    function updateTimerDisplay() {
      const display = $('timerDisplay');
      display.textContent = `â±ï¸ ${gameState.timeLeft}s`;
      display.classList.toggle('warning', gameState.timeLeft <= 5);
    }
    
    function handleTimeout() {
      showAnswer(false, true);
    }
    
    function selectOption(songId) {
      if (gameState.showingAnswer) return;
      
      const song = gameState.questions[gameState.currentQuestion];
      const isCorrect = songId === song.id;
      
      // æ›´æ–°æŒ‰é’®æ ·å¼
      document.querySelectorAll('.option-btn').forEach(btn => {
        const btnId = parseInt(btn.dataset.id);
        if (btnId === song.id) {
          btn.classList.add('correct');
        } else if (btnId === songId && !isCorrect) {
          btn.classList.add('wrong');
        } else {
          btn.classList.add('dimmed');
        }
      });
      
      showAnswer(isCorrect, false);
    }
    
    function submitFillAnswer() {
      if (gameState.showingAnswer) return;
      
      const song = gameState.questions[gameState.currentQuestion];
      const userAnswer = $('fillInput').value.trim().toLowerCase();
      const isCorrect = userAnswer === song.answer.toLowerCase();
      
      // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
      const parts = song.fillBlank.split('___');
      $('questionContent').innerHTML = parts[0] + `<span style="color: #fbbf24; font-weight: bold;">${song.answer}</span>` + (parts[1] || '');
      
      showAnswer(isCorrect, false);
    }
    
    function showAnswer(isCorrect, isTimeout) {
      gameState.showingAnswer = true;
      const song = gameState.questions[gameState.currentQuestion];
      const isMulti = gameState.mode === 'multi';
      
      // è®°å½•ç­”é¢˜
      const result = { song, correct: isCorrect, timeout: isTimeout };
      gameState.answeredQuestions.push(result);
      
      if (isMulti) {
        if (gameState.currentPlayer === 1) {
          gameState.player1Answers.push(result);
        } else {
          gameState.player2Answers.push(result);
        }
      }
      
      // è®¡ç®—å¾—åˆ†
      if (isCorrect) {
        const timeBonus = Math.floor(gameState.timeLeft * 2);
        const streakBonus = gameState.streak * 10;
        const hintPenalty = gameState.showingHint ? 25 : 0;
        const diffBonus = gameState.difficulty === 'hard' ? 50 : 0;
        const points = 100 + timeBonus + streakBonus - hintPenalty + diffBonus;
        
        if (isMulti) {
          if (gameState.currentPlayer === 1) {
            gameState.player1Score += points;
          } else {
            gameState.player2Score += points;
          }
        } else {
          gameState.score += points;
        }
        
        gameState.streak++;
        gameState.maxStreak = Math.max(gameState.maxStreak, gameState.streak);
      } else {
        gameState.streak = 0;
      }
      
      // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
      if (isMulti) {
        $('scoreDisplay').textContent = `â­ ${gameState.currentPlayer === 1 ? gameState.player1Score : gameState.player2Score}`;
        $('p1Score').textContent = `${gameState.player1Name}: ${gameState.player1Score}`;
        $('p2Score').textContent = `${gameState.player2Name}: ${gameState.player2Score}`;
      } else {
        $('scoreDisplay').textContent = `â­ ${gameState.score}`;
      }
      
      // æ˜¾ç¤ºç»“æœ
      const resultDiv = $('answerResult');
      resultDiv.classList.remove('hidden');
      resultDiv.className = `answer-result ${isCorrect ? 'correct' : 'wrong'}`;
      
      let resultText = isCorrect ? 'ğŸ‰ å›ç­”æ­£ç¡®ï¼' : (isTimeout ? 'â° æ—¶é—´åˆ°ï¼' : 'ğŸ˜… ç­”é”™äº†~');
      $('answerResultText').innerHTML = `<span style="font-size: 20px; margin-right: 8px;">${isCorrect ? 'ğŸ‰' : 'ğŸ˜…'}</span><span style="font-weight: bold;">${resultText}</span>`;
      $('correctAnswerText').innerHTML = `æ­£ç¡®ç­”æ¡ˆï¼š<span class="answer-song" style="background: ${artistColors[song.artist]}">${artistEmoji[song.artist]} ${song.artist} - ${song.title}</span>`;
      
      // ä¸‹ä¸€æ­¥æŒ‰é’®
      const nextBtn = $('nextBtn');
      nextBtn.classList.remove('hidden');
      
      if (isMulti) {
        if (gameState.currentPlayer === 1) {
          nextBtn.textContent = `æ¢ ${gameState.player2Name} â†’`;
        } else {
          nextBtn.textContent = gameState.currentQuestion + 1 >= 10 ? 'æŸ¥çœ‹ç»“æœ ğŸ“Š' : 'ä¸‹ä¸€é¢˜ â†’';
        }
      } else {
        nextBtn.textContent = gameState.currentQuestion + 1 >= 10 ? 'æŸ¥çœ‹ç»“æœ ğŸ“Š' : 'ä¸‹ä¸€é¢˜ â†’';
      }
      
      // ç¦ç”¨å¡«ç©ºè¾“å…¥
      $('fillInput').disabled = true;
    }
    
    function useHint() {
      if (gameState.showingHint || gameState.showingAnswer) return;
      
      const song = gameState.questions[gameState.currentQuestion];
      gameState.showingHint = true;
      gameState.hintsUsed++;
      
      $('hintBtn').disabled = true;
      $('hintBtn').textContent = 'ğŸ’¡ æç¤ºå·²æ˜¾ç¤º';
      $('hintText').classList.remove('hidden');
      $('hintText').textContent = `ğŸ’¡ ${song.hint}`;
    }
    
    function nextQuestion() {
      const isMulti = gameState.mode === 'multi';
      
      if (isMulti) {
        if (gameState.currentPlayer === 1) {
          // åˆ‡æ¢åˆ°ç©å®¶2
          gameState.currentPlayer = 2;
          gameState.streak = 0;
          showPlayerSwitch();
          return;
        } else {
          // ç©å®¶2ç­”å®Œ
          if (gameState.currentQuestion + 1 >= 10) {
            showResult();
            return;
          }
          gameState.currentQuestion++;
          gameState.currentPlayer = 1;
          gameState.streak = 0;
          showPlayerSwitch();
          return;
        }
      } else {
        // å•äººæ¨¡å¼
        if (gameState.currentQuestion + 1 >= 10) {
          showResult();
          return;
        }
        gameState.currentQuestion++;
      }
      
      $('fillInput').disabled = false;
      loadQuestion();
      startTimer();
    }
    
    function showPlayerSwitch() {
      clearInterval(gameState.timer);
      
      $('switchIcon').textContent = gameState.currentPlayer === 1 ? 'ğŸ®' : 'ğŸ¯';
      $('switchTitle').textContent = `è½®åˆ° ${gameState.currentPlayer === 1 ? gameState.player1Name : gameState.player2Name}`;
      $('switchP1Name').textContent = gameState.player1Name;
      $('switchP2Name').textContent = gameState.player2Name;
      $('switchP1Score').textContent = gameState.player1Score;
      $('switchP2Score').textContent = gameState.player2Score;
      $('switchQuestionNum').textContent = `ç¬¬ ${gameState.currentQuestion + 1}/10 é¢˜`;
      
      showScreen('playerSwitch');
    }
    
    function continueGame() {
      showScreen('gameScreen');
      $('fillInput').disabled = false;
      loadQuestion();
      startTimer();
    }
    
    // ==================== ç»“æœé¡µé¢ ====================
    function showResult() {
      clearInterval(gameState.timer);
      
      const isMulti = gameState.mode === 'multi';
      
      if (isMulti) {
        showMultiResult();
      } else {
        showSingleResult();
      }
      
      // ç­”é¢˜è®°å½•
      renderAnswerHistory();
      
      showScreen('resultScreen');
    }
    
    function showSingleResult() {
      $('singleResult').classList.remove('hidden');
      $('multiResult').classList.add('hidden');
      $('leaderboardInput').classList.remove('hidden');
      
      const correctCount = gameState.answeredQuestions.filter(q => q.correct).length;
      const accuracy = Math.round((correctCount / 10) * 100);
      
      // æ’å
      let rank = { title: "éŸ³ä¹å°ç™½", emoji: "ğŸ£" };
      if (accuracy >= 90) rank = { title: "çŒœæ­Œä¹‹ç‹", emoji: "ğŸ‘‘" };
      else if (accuracy >= 70) rank = { title: "éŸ³ä¹è¾¾äºº", emoji: "ğŸµ" };
      else if (accuracy >= 50) rank = { title: "æ­Œæ›²çˆ±å¥½è€…", emoji: "ğŸ§" };
      
      $('resultIcon').textContent = rank.emoji;
      $('resultTitle').textContent = rank.title;
      $('finalScore').textContent = gameState.score;
      $('accuracy').textContent = `${accuracy}%`;
      $('maxStreak').textContent = gameState.maxStreak;
      $('totalTime').textContent = `${gameState.totalTime}s`;
    }
    
    function showMultiResult() {
      $('singleResult').classList.add('hidden');
      $('multiResult').classList.remove('hidden');
      
      const p1Wins = gameState.player1Score > gameState.player2Score;
      const p2Wins = gameState.player2Score > gameState.player1Score;
      const tie = gameState.player1Score === gameState.player2Score;
      
      $('resultIcon').textContent = tie ? 'ğŸ¤' : 'ğŸ†';
      $('resultTitle').textContent = tie ? 'å¹³å±€ï¼' : `${p1Wins ? gameState.player1Name : gameState.player2Name} è·èƒœï¼`;
      
      $('multiP1Name').textContent = gameState.player1Name;
      $('multiP2Name').textContent = gameState.player2Name;
      $('multiP1Score').textContent = gameState.player1Score;
      $('multiP2Score').textContent = gameState.player2Score;
      $('multiP1Correct').textContent = `${gameState.player1Answers.filter(a => a.correct).length}/${gameState.player1Answers.length} æ­£ç¡®`;
      $('multiP2Correct').textContent = `${gameState.player2Answers.filter(a => a.correct).length}/${gameState.player2Answers.length} æ­£ç¡®`;
      
      $('multiP1Medal').textContent = p1Wins ? 'ğŸ¥‡' : (tie ? 'ğŸ¤' : 'ğŸ¥ˆ');
      $('multiP2Medal').textContent = p2Wins ? 'ğŸ¥‡' : (tie ? 'ğŸ¤' : 'ğŸ¥ˆ');
      
      $('multiP1Card').classList.toggle('winner', p1Wins);
      $('multiP2Card').classList.toggle('winner', p2Wins);
    }
    
    function renderAnswerHistory() {
      const list = $('historyList');
      list.innerHTML = gameState.answeredQuestions.map(q => `
        <div class="answer-history-item ${q.correct ? 'correct' : 'wrong'}">
          <span>${q.correct ? 'âœ“' : 'âœ—'} <span class="song-info">${q.song.title}</span> <span class="artist">- ${q.song.artist}</span></span>
        </div>
      `).join('');
    }
    
    function playAgain() {
      startGame(gameState.selectedMode);
    }
    
    function changeMode() {
      showScreen('modeSelect');
    }
    
    // ==================== æ’è¡Œæ¦œ ====================
    function loadLeaderboard() {
      try {
        const saved = localStorage.getItem('musicGameLeaderboard');
        if (saved) {
          leaderboard = JSON.parse(saved);
        }
      } catch (e) {
        console.log('Failed to load leaderboard');
      }
    }
    
    function saveLeaderboard() {
      try {
        localStorage.setItem('musicGameLeaderboard', JSON.stringify(leaderboard));
      } catch (e) {
        console.log('Failed to save leaderboard');
      }
    }
    
    function submitScore() {
      const name = $('nameInput').value.trim();
      if (!name) return;
      
      const entry = {
        name,
        score: gameState.score,
        date: new Date().toLocaleDateString('zh-CN'),
        id: Date.now()
      };
      
      leaderboard.push(entry);
      leaderboard.sort((a, b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 20);
      saveLeaderboard();
      
      $('leaderboardInput').classList.add('hidden');
      $('nameInput').value = '';
      
      alert('ğŸ‰ åˆ†æ•°å·²æäº¤ï¼');
    }
    
    function renderLeaderboard() {
      if (leaderboard.length === 0) {
        $('leaderboardEmpty').classList.remove('hidden');
        $('leaderboardList').classList.add('hidden');
      } else {
        $('leaderboardEmpty').classList.add('hidden');
        $('leaderboardList').classList.remove('hidden');
        
        $('leaderboardItems').innerHTML = leaderboard.map((entry, index) => `
          <div class="leaderboard-item ${index < 3 ? 'top3' : ''}">
            <div class="rank">${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : index + 1}</div>
            <div class="name">${entry.name}</div>
            <div class="score">${entry.score}</div>
            <div class="date">${entry.date}</div>
          </div>
        `).join('');
      }
    }
    
    // ==================== åˆå§‹åŒ– ====================
    // å¡«ç©ºæ¨¡å¼å›è½¦æäº¤
    $('fillInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') submitFillAnswer();
    });
    
    // åŠ è½½æ’è¡Œæ¦œ
    loadLeaderboard();
    
    // æ˜¾ç¤ºä¸»èœå•
    showScreen('menu');
  </script>
</body>
</html>
